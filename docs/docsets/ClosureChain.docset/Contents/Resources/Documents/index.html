<!DOCTYPE html>
<html lang="en">
  <head>
    <title>ClosureChain  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="ClosureChain  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          ClosureChain 0.0.3 Docs
        </a>
         (95% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/dannys42/ClosureChain">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">ClosureChain Reference</a>
      <img class="carat" src="img/carat.png" />
      ClosureChain  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ClosureChain.html">ClosureChain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ClosureChain/Failures.html">– Failures</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ClosureChain/Link.html">– Link</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <p align="center">
<a href="https://github.com/dannys42/ClosureChain/actions?query=workflow%3ASwift"><img src="https://github.com/dannys42/ClosureChain/workflows/Swift/badge.svg" alt="build status"></a>
<img src="https://img.shields.io/badge/os-macOS-green.svg?style=flat" alt="macOS">
<img src="https://img.shields.io/badge/os-iOS-green.svg?style=flat" alt="iOS">
<img src="https://img.shields.io/badge/os-linux-green.svg?style=flat" alt="Linux">
<a href="LICENSE"><img src="https://img.shields.io/badge/license-Apache2-blue.svg?style=flat" alt="Apache 2"></a>
<br/>
<a href="https://swiftpackageindex.com/dannys42/ClosureChain"><img src="https://img.shields.io/endpoint?url=https%3A%2F%2Fswiftpackageindex.com%2Fapi%2Fpackages%2Fdannys42%2FClosureChain%2Fbadge%3Ftype%3Dswift-versions"></a>
<a href="https://swiftpackageindex.com/dannys42/ClosureChain"><img src="https://img.shields.io/endpoint?url=https%3A%2F%2Fswiftpackageindex.com%2Fapi%2Fpackages%2Fdannys42%2FClosureChain%2Fbadge%3Ftype%3Dplatforms"></a>
</p>
<h1 id='closurechain' class='heading'>ClosureChain</h1>

<p><code><a href="Classes/ClosureChain.html">ClosureChain</a></code> simplifies sequential async completion methods for Swift.  It provides a familiar try-catch pattern for sequential async methods.</p>
<h2 id='installation' class='heading'>Installation</h2>
<h3 id='swift-package-manager' class='heading'>Swift Package Manager</h3>

<p>Add the <code><a href="Classes/ClosureChain.html">ClosureChain</a></code> package to the dependencies within your application&rsquo;s <code>Package.swift</code> file.  Substitute &ldquo;x.y.z&rdquo; with the latest <code><a href="Classes/ClosureChain.html">ClosureChain</a></code> <a href="https://github.com/dannys42/ClosureChain/releases">release</a>.</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/dannys42/ClosureChain.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"x.y.z"</span><span class="p">)</span>
</code></pre>

<p>Add <code><a href="Classes/ClosureChain.html">ClosureChain</a></code> to your target&rsquo;s dependencies:</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">target</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"example"</span><span class="p">,</span> <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"ClosureChain"</span><span class="p">]),</span>
</code></pre>
<h3 id='cocoapods' class='heading'>Cocoapods</h3>

<p>Add <code><a href="Classes/ClosureChain.html">ClosureChain</a></code> to your Podfile:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="sb">`ClosureChain`</span>
</code></pre>
<h2 id='usage' class='heading'>Usage</h2>

<p>Typically in Swift, network or other async methods make use of completion handlers to streamline work.  A typical method signature looks like this:</p>
<pre class="highlight swift"><code>    <span class="kd">func</span> <span class="nf">someAsyncMethod</span><span class="p">(</span><span class="n">_</span> <span class="nv">completion</span><span class="p">:</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Error</span><span class="p">?)</span><span class="o">-&gt;</span><span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
</code></pre>

<p>However, this can become difficult to manage when you need to perform a number of async functions, each relying on success data from the previous call.</p>

<p>Normally this requires nesting the async methods or the use of a state machine.  Both of which can be difficult to reason about.</p>

<p>Closure Chains simplify this by allowing the developer to treat each async call as linkage of throwable closures. (i.e. links in a chain), with a single <code>catch</code> closure to manage any errors.</p>
<h3 id='simple-example' class='heading'>Simple Example</h3>
<pre class="highlight swift"><code>    <span class="k">let</span> <span class="nv">chain</span> <span class="o">=</span> <span class="kt">ClosureChain</span><span class="p">()</span>
    <span class="n">chain</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="n">link</span> <span class="k">in</span>
        <span class="nf">someAsyncMethod</span><span class="p">()</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span> 
            <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
                <span class="n">link</span><span class="o">.</span><span class="nf">throw</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>                   <span class="c1">// use `link.throw()` since completion block is not throwable</span>
            <span class="p">}</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">data</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">link</span><span class="o">.</span><span class="nf">throw</span><span class="p">(</span><span class="kt">Failure</span><span class="o">.</span><span class="n">missingDdata</span><span class="p">)</span>    <span class="c1">// use `link.throw()` since completion block is not throwable</span>
                <span class="k">return</span>
            <span class="p">}</span>
            <span class="c1">// do something with `data`</span>

            <span class="n">link</span><span class="o">.</span><span class="nf">success</span><span class="p">()</span>                          <span class="c1">// required</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">chain</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
        <span class="c1">// error handler</span>
    <span class="p">}</span>
    <span class="n">chain</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>                                   <span class="c1">// required to start executing links</span>
</code></pre>

<p>Note the familiar <code>try-catch</code> pattern.  However <code>try</code> is perfomed on the chain <code>chain</code>, and the <code>throw</code> is performed on the <code>link</code>.  As a convenience, you can simply use the Swift <code>throw</code> command directly within a try-block.</p>

<p>There are two additional required functions:</p>

<ul>
<li><code>link.success()</code> is required to let <code><a href="Classes/ClosureChain.html">ClosureChain</a></code> know when an async task is complete</li>
<li><code>chain.start()</code> is required to kick off execution of the chain.  No links will be executed until the <code>.start()</code> command is initiated.</li>
</ul>
<h3 id='passing-data' class='heading'>Passing data</h3>

<p>The above is not very useful when we only have one async operation.  But what if we have several async operations that we wish to perform.  For example imagine we are attempt to perform this sequence of tasks:</p>

<ul>
<li>Get raw image data from network</li>
<li>Convert raw data to a UIImage object.  Perhaps we have a long running async task here that will perform decryption, digital signature verification, and JSON deserialization</li>
<li>Do more background processing on UIImage</li>
<li>Notify the user we&rsquo;re done</li>
</ul>

<p>For simplicity, we&rsquo;ll assume all our async methods are using the <code>Result</code> protocol.</p>

<p>This is how this might look with <code><a href="Classes/ClosureChain.html">ClosureChain</a></code>:</p>
<pre class="highlight swift"><code><span class="n">function</span> <span class="nf">closureChainExample</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">chain</span> <span class="o">=</span> <span class="kt">ClosureChain</span><span class="p">()</span>
    <span class="n">chain</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="n">link</span> <span class="k">in</span>
        <span class="nf">getDataAsync</span><span class="p">()</span> <span class="p">{</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">,</span><span class="kt">Error</span><span class="o">&gt;</span> <span class="k">in</span>  <span class="c1">// Result type is provided solely for context in this example</span>
            <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
                <span class="n">link</span><span class="o">.</span><span class="nf">throw</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>       <span class="c1">// use link.throw() since completion handler is not throwable</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">data</span><span class="p">):</span>
                <span class="n">link</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>      <span class="c1">// Pass `data` to the next link</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">chain</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">,</span> <span class="n">link</span> <span class="k">in</span>     <span class="c1">// `data` type must match prior link.success() (this check is performed at run-time)</span>
        <span class="nf">convertToUIImage</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="p">,</span><span class="kt">Error</span><span class="o">&gt;</span> <span class="k">in</span>   <span class="c1">// Result type is provided solely for context in this example</span>
            <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
                <span class="n">link</span><span class="o">.</span><span class="nf">throw</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>       <span class="c1">// use link.throw() since completion handler is not throwable</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">uiimage</span><span class="p">):</span>
                <span class="n">link</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">uiimage</span><span class="p">)</span>   <span class="c1">// Pass `uiimage` to the next link</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">chain</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">,</span> <span class="n">link</span> <span class="k">in</span> <span class="c1">// `image` type must match prior link.success()</span>
        <span class="nf">processImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="p">{</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">?</span> <span class="k">in</span>      <span class="c1">// Error type is provided solely for context in this example</span>
            <span class="k">do</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
                    <span class="nf">throw</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>        <span class="c1">// can use do-catch to allow `throws` to pass to `link.throw()`</span>
                <span class="p">}</span>
                <span class="n">link</span><span class="o">.</span><span class="nf">success</span><span class="p">()</span>          <span class="c1">// Go to next link with no passed data</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
                <span class="n">link</span><span class="o">.</span><span class="nf">throw</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">chain</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="n">link</span> <span class="k">in</span>                 <span class="c1">// It is safe to ignore the passed parameter from the last `link.success()`</span>
        <span class="c1">// Notify the user we're done</span>
        <span class="n">link</span><span class="o">.</span><span class="nf">success</span><span class="p">()</span>                  <span class="c1">// Required even though this is the last link</span>
    <span class="p">}</span>

    <span class="n">chain</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
        <span class="c1">// error handler</span>
    <span class="p">}</span>
    <span class="n">chain</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>                       <span class="c1">// Required to start executing links</span>
<span class="p">}</span>
</code></pre>

<p>Notes:</p>

<ul>
<li><code>chain</code> can be safely allowed to fall out-of-scope.  <code>chain</code> and the
associated closures will not be released from memory until <code>link.success()</code>
in the last link is called.</li>
<li>ClosureChains make no use of DispatchQueue or OperationQueue.  Therefore
there is no guarantee that any link is executing on any specific
queue/thread.</li>
</ul>
<h3 id='results-can-be-even-better' class='heading'>Results can be Even Better</h3>

<p>If your async methods have completion handlers that take a single Result parameter, such as:</p>
<pre class="highlight swift"><code>    <span class="kd">func</span> <span class="nf">someAsyncMethod</span><span class="p">(</span><span class="n">_</span> <span class="nv">completion</span><span class="p">:</span> <span class="p">(</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
</code></pre>

<p>You can further streamline your code:</p>
<pre class="highlight swift"><code><span class="n">function</span> <span class="nf">closureChainExample</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">chain</span> <span class="o">=</span> <span class="kt">ClosureChain</span><span class="p">()</span>
    <span class="n">chain</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="n">link</span> <span class="k">in</span>
        <span class="nf">getDataAsync</span><span class="p">()</span> <span class="p">{</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">,</span><span class="kt">Error</span><span class="o">&gt;</span> <span class="k">in</span>  <span class="c1">// Result type is provided solely for context in this example</span>
            <span class="n">link</span><span class="o">.</span><span class="nf">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>           <span class="c1">// calls link.throw() or link.success() appropriately</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">chain</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">,</span> <span class="n">link</span> <span class="k">in</span>     <span class="c1">// `data` type must match prior link.success() (this check is performed at run-time)</span>
        <span class="nf">convertToUIImage</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="p">,</span><span class="kt">Error</span><span class="o">&gt;</span> <span class="k">in</span>   <span class="c1">// Result type is provided solely for context in this example</span>
            <span class="n">link</span><span class="o">.</span><span class="nf">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>         <span class="c1">// calls link.throw() or link.success() appropriately</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">chain</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">,</span> <span class="n">link</span> <span class="k">in</span> <span class="c1">// `image` type must match prior link.success()</span>
        <span class="nf">processImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="p">{</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="p">,</span><span class="kt">Error</span><span class="o">&gt;</span> <span class="k">in</span>      <span class="c1">// Result type is provided solely for context in this example</span>
            <span class="n">link</span><span class="o">.</span><span class="nf">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">chain</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="n">link</span> <span class="k">in</span>                 <span class="c1">// It is safe to ignore the passed parameter from the last `link.success()`</span>
        <span class="c1">// Notify the user we're done</span>
        <span class="n">link</span><span class="o">.</span><span class="nf">success</span><span class="p">()</span>                  <span class="c1">// Required even though this is the last link</span>
    <span class="p">}</span>

    <span class="n">chain</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
        <span class="c1">// error handler</span>
    <span class="p">}</span>
    <span class="n">chain</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>                       <span class="c1">// Required to start executing links</span>
<span class="p">}</span>
</code></pre>
<h2 id='api-documentation' class='heading'>API Documentation</h2>

<p>For more information visit our <a href="https://dannys42.github.io/ClosureChain/">API reference</a>.</p>
<h2 id='license' class='heading'>License</h2>

<p>This library is licensed under Apache 2.0. The full license text is available in <a href="LICENSE">LICENSE</a>.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2020 <a class="link" href="https://github.com/dannys42/ClosureChain" target="_blank" rel="external">Danny Sung <a href="mailto:danny@dannysung.com">danny@dannysung.com</a></a>. All rights reserved. (Last updated: 2020-12-04)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
