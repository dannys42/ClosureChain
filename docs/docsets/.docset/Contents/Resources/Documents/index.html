<!DOCTYPE html>
<html lang="en">
  <head>
    <title>  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
           Docs
        </a>
         (95% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html"> Reference</a>
      <img class="carat" src="img/carat.png" />
        Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ClosureChain.html">ClosureChain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ClosureChain/Failures.html">– Failures</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ClosureChain/Link.html">– Link</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='closurechain' class='heading'>ClosureChain</h1>

<p><code><a href="Classes/ClosureChain.html">ClosureChain</a></code> simplifies sequential async completion methods for Swift.  It provides a familiar try-catch pattern for sequential async methods.</p>
<h2 id='installation' class='heading'>Installation</h2>
<h3 id='swift-package-manager' class='heading'>Swift Package Manager</h3>

<p>Add the <code><a href="Classes/ClosureChain.html">ClosureChain</a></code> package to the dependencies within your application&rsquo;s <code>Package.swift</code> file.  Substitute &ldquo;x.y.z&rdquo; with the latest <code><a href="Classes/ClosureChain.html">ClosureChain</a></code> <a href="https://github.com/dannys42/ClosureChain/releases">release</a>.</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/dannys42/ClosureChain.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"x.y.z"</span><span class="p">)</span>
</code></pre>

<p>Add <code><a href="Classes/ClosureChain.html">ClosureChain</a></code> to your target&rsquo;s dependencies:</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">target</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"example"</span><span class="p">,</span> <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"ClosureChain"</span><span class="p">]),</span>
</code></pre>
<h3 id='cocoapods' class='heading'>Cocoapods</h3>

<p>Add <code><a href="Classes/ClosureChain.html">ClosureChain</a></code> to your Podfile:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="sb">`ClosureChain`</span>
</code></pre>
<h2 id='usage' class='heading'>Usage</h2>

<p>Typically in Swift, network or other async methods make use of completion handlers to streamline work.  A typical method signature looks like this:</p>
<pre class="highlight swift"><code>  <span class="kd">func</span> <span class="nf">someAsyncMethod</span><span class="p">(</span><span class="n">_</span> <span class="nv">completion</span><span class="p">:</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Error</span><span class="p">?)</span><span class="o">-&gt;</span><span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>
</code></pre>

<p>However, this can become difficult to manage when you need to perform a number of async functions, each relying on success data from the previous call.</p>

<p>Normally this requires nesting the async methods or the use of a state machine.  Both of which can be difficult to reason about.</p>

<p>Closure Chains simplify this by allowing the developer to treat each async call as a <code>try</code> block (also referred to as a <code>Link</code> in a <code><a href="Classes/ClosureChain.html">ClosureChain</a></code>) with a single <code>catch</code> block to manage any errors.</p>
<h3 id='simple-example' class='heading'>Simple Example</h3>
<pre class="highlight swift"><code>   <span class="k">let</span> <span class="nv">cc</span> <span class="o">=</span> <span class="kt">ClosureChain</span><span class="p">()</span>
   <span class="n">cc</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="n">link</span> <span class="k">in</span>
           <span class="nf">someAsyncMethod</span><span class="p">()</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span> 
               <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
                   <span class="n">link</span><span class="o">.</span><span class="nf">throw</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
               <span class="p">}</span>
               <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">data</span> <span class="k">else</span> <span class="p">{</span>
                   <span class="n">link</span><span class="o">.</span><span class="nf">throw</span><span class="p">(</span><span class="kt">Failure</span><span class="o">.</span><span class="n">missingDdata</span><span class="p">)</span>
                   <span class="k">return</span>
            <span class="p">}</span>
            <span class="c1">// do something with `data`</span>

               <span class="n">link</span><span class="o">.</span><span class="nf">success</span><span class="p">()</span> <span class="c1">// required</span>
           <span class="p">}</span>
   <span class="p">}</span>
   <span class="n">cc</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
           <span class="c1">// error handler</span>
   <span class="p">}</span>
   <span class="n">cc</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>     <span class="c1">// required</span>
</code></pre>

<p>Note the familiar <code>try-catch</code> pattern.  However <code>try</code> is perfomed on the chain <code>cc</code>, and the <code>throw</code> is performed on the <code>link</code>.  As a convenience, you can simply use the Swift <code>throw</code> command directly within a try-block.</p>

<p>There are two additional required functions:</p>

<ul>
<li><code>link.success()</code> is required to let <code><a href="Classes/ClosureChain.html">ClosureChain</a></code> know when an async task is complete</li>
<li><code>cc.start()</code> is required to kick off execution of the chain.  No try blocks will be executed until the <code>.start()</code> command is initiated.</li>
</ul>
<h3 id='passing-data' class='heading'>Passing data</h3>

<p>The above is not very useful when we only have one async operation.  But what if we have several async operations that we wish to perform.  For example imagine we are attempt to perform this sequence of tasks:</p>

<ul>
<li>Get raw image data from network</li>
<li>Convert raw data to a UIImage object.  Perhaps we have a long running async task here that will perform decryption, digital signature verification, and JSON deserialization</li>
<li>Save the UIImage to a remote data-store</li>
</ul>

<p>For simplicity, we&rsquo;ll assume all our async methods are using the <code>Result</code> protocol.</p>

<p>This is how this might look with <code><a href="Classes/ClosureChain.html">ClosureChain</a></code>:</p>
<pre class="highlight swift"><code><span class="n">function</span> <span class="nf">closureChainExample</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">cc</span> <span class="o">=</span> <span class="kt">ClosureChain</span><span class="p">()</span>
    <span class="n">cc</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="n">link</span> <span class="k">in</span>
           <span class="nf">getDataAsync</span><span class="p">()</span> <span class="p">{</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">,</span><span class="kt">Error</span><span class="o">&gt;</span> <span class="k">in</span>  <span class="c1">// result type is provided solely for context</span>
               <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
                   <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
                       <span class="k">throw</span> <span class="n">error</span>              <span class="c1">// C1</span>
                   <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">data</span><span class="p">):</span>
                       <span class="n">link</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>       <span class="c1">// C2</span>
               <span class="p">}</span>
           <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">cc</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">,</span> <span class="n">link</span> <span class="k">in</span>                <span class="c1">// C3</span>
        <span class="nf">convertToUIImage</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="p">,</span><span class="kt">Error</span><span class="o">&gt;</span> <span class="k">in</span> <span class="c1">// result type is provided solely for context</span>
            <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
                    <span class="k">throw</span> <span class="n">error</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">uiimage</span><span class="p">):</span>
                    <span class="n">link</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">uiimage</span><span class="p">)</span>       <span class="c1">// C4</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">cc</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">,</span> <span class="n">link</span> <span class="k">in</span>
        <span class="nf">saveToDataStore</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">?</span> <span class="k">in</span> <span class="c1">// result type is provided solely for context</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="n">error</span>
            <span class="p">}</span>
            <span class="n">link</span><span class="o">.</span><span class="nf">success</span><span class="p">()</span>                      <span class="c1">// C5</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">cc</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
        <span class="c1">// error handler</span>
    <span class="p">}</span>
    <span class="n">cc</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>                                  <span class="c1">// C6</span>
<span class="p">}</span>                                               <span class="c1">// C7</span>
</code></pre>

<ul>
<li>[C1] we can use <code>throw</code> directly in a try block</li>
<li>[C2] the data is passed to [C3] as a typed parameter.  (This type-check is performed at run-time.)</li>
<li>[C3] <code>data</code> must be declared with a type specified.</li>
<li>[C4] now passes a different data type to the next block</li>
<li>[C5] <code>.success()</code> must be called at the completion of the try-block, but need not pass any data.</li>
<li>[C6] <code>.start()</code> is required to execute try-blocks.  No blocks will be executed until this is called.</li>
<li>[C7] <code>cc</code> can be safely allowed to fall out-of-scope.  It does not need to be retained in a containing class variable.</li>
</ul>
<h2 id='api-documentation' class='heading'>API Documentation</h2>

<p>For more information visit our <a href="https://dannys42.github.io/ClosureChain/">API reference</a>.</p>
<h2 id='license' class='heading'>License</h2>

<p>This library is licensed under Apache 2.0. The full license text is available in <a href="LICENSE">LICENSE</a>.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2020 <a class="link" href="" target="_blank" rel="external"></a>. All rights reserved. (Last updated: 2020-11-07)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.5</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
